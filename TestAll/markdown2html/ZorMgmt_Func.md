# 1 功能概览
对正向订单ZOR/ZMOR/FOD查询、修改以及查看其相关历史的功能。

## 1.2 位置

正向订单管理 - 正向订单查询

![](imgs/ZorMgmt001.png)

## 1.3 界面介绍
界面内容如下：

![](imgs/ZorMgmt002.png)

**查询区域**

查询区域负责录入查询条件，分为两种
1. 唯一条件检索
2. 符合条件检索

唯一条件检索，提供了唯一的编号查询，可以一次性录入多条单号进行查询
复合检索条件，提供了多重检索的方式，供客户在不同条件下进行检索

此外，还可以进行数据导出，方便用户使用

**明细列表**

查询出来的订单的明细列表，列举了查询出来的订单的结果

**功能操作区域**

可以针对，选择出来的订单进行处理。包括修改订单的基础信息。修改订单的财务信息。查看订单的状态变化历史，查看订单的修改历史。

# 2 订单搜索功能

## 2.1 唯一检索条件
唯一检索条件，是每次只能选择一种单号类型进行检索的方式。每次选定一个单号类型之后，可以录入多个单号，每个一行。

![](imgs/ZorMgmt003.png)

可选的单号类型包括:
- BTCPSO
- 客户PO编号
- 参考支付号
- 快递订单号
- 发票号码
- Billing号码
- ECCSO

关系说明如下：
<table>
    <thead>
        <tr>
            <th>类型</th>
            <th>来源</th>
            <th>说明</th>
        <tr>
    </thead>
    <tbody>
        <tr>
            <td>BTCPSO</td>
            <td>BTCP</td>
            <td>BTCP系统中的订单号码，例如：N000234567,R000123456</td>
        </tr>
        <tr>
            <td>客户PO编号</td>
            <td>上游系统</td>
            <td>订单原始单号，是由客户实际下单系统才产生</td>
        </tr>
        <tr>
            <td>参考支付号</td>
            <td>上游系统</td>
            <td>订单原始支付凭证号，是由客户实际下单系统才产生</td>
        </tr>
        <tr>
            <td>快递订单号</td>
            <td>WMS</td>
            <td>快递发货的单号，依照公司不同而是不同，例如：613368699482</td>
        </tr>
        <tr>
            <td>发票号码</td>
            <td>VAT</td>
            <td>联想给客户开具发票的号码，例如：20679879</td>
        </tr>
        <tr>
            <td>Billing号码</td>
            <td>ECC</td>
            <td>ECC开票凭证的号码，俗称99号，例如：9963793198</td>
        </tr>
        <tr>
            <td>ECCSO</td>
            <td>ECC</td>
            <td>ECC的销售订单号码，例如：0150336473</td>
        </tr>
    </tbody>
</table>

## 2.2 唯一检索条件 - 导出

功能同唯一检索条件，内容上差不多，只不过是以Excel表格的方式导出查询的结果。

## 2.3 复合条件检索

提供了多重条件进行检索。不过这里提供了权限限制，针对当前用户，系统会自动从后台带出用户可见的权限。例如官网的用户可以看到自己系统发出的订单，而EPP系统的用户则不能查询官网的订单。

目前权限类型是通过客户编号进行区分的。每个用户在使用查询的时候，客户编号一栏中出现的全部内容，即当前客户所有的权限范围。

![](imgs/ZorMgmt004.png)

主要检索条件包括：
1. 时间范围
2. 发票类型
3. 是否服务
4. 商品编号
5. 税率
6. 定制类型
7. 客户编号
8. 订单类型 
9. 以上复合   

以下逐一介绍检索条件

### 2.3.1 时间范围检索

时间范围检索包括的时间条件：
1. 创建时间 - 订单在BTCP中创建的时间
2. 下单时间 - 订单在前端系统中的创建时间
3. 装箱打印时间 - 订单在BTCP中打印装箱单的时间

![](imgs/ZorMgmt005.png)

时间范围包括两种情况：开始时间、结束时间。

这里的时间范围，设定的是时间条件的起始、结束范围

- 开始时间不指定的时候，默认为1980-01-01 00:00:00
- 结束时间不指定的时候，默认为当天的23:59:59

### 2.3.2. 发票类型

![](imgs/ZorMgmt006.png)

发票类型包括如下情况：
1. 通用机打发票 —— T
2. 电子票 —— D
3. 增普票 —— P
4. 增专票 —— Z

对应了传入BTCP系统订单的发票类型。现在通用机打发票已经废弃，所以实际使用的只有D、P、Z三种发票类型。

但是作为历史数据T票依然存在。

### 2.3.3. 是否服务

是否服务，是指订单中是否包含服务物料。如果订单所携带的商品中包含服务物料，则订单会被判定为服务订单。极端情况下，整个订单中的商品都是服务商品，则此订单服务的纯粹。

目前BTCP系统中尚没有SAP CRM 和 ECC中的服务订单的概念。

### 2.3.4. 商品编号

根据订单中商品的商品编号进行查询的方式，建议每行一个商品编号。

此种查询效率很低，建议配合其他的条件一起查询。

### 2.3.5. 税率

依照订单中商品的税率进行订单查询的方式。目前税率包括
1. 17%
2. 6%

与商品编号查询类似，这种查询方式效率较低，建议与其他条件结合使用

### 2.3.6. 定制类型

定制类型是依照与订单本身的商品的定制类型而言的。

目前定制商品包括：
1. MTM - 成品物料
2. CTO - 包括Y700 和 Y900的商品
3. 丝印 - 新增的封面以及定制刻字的商品

这种查询方式，是针对订单所携带的物料的定制属性而定的。

如果订单中不含有任何可定制的商品，则订单就是MTM。

如果订单中含有Y700或者Y900系列的商品，则订单就是CTO。

如果订单中含有丝印定制系列的商品，则订单就是丝印。

以上三种定制类型是互斥的。订单的定制类型只能是其中之一，不能是其中的两个。换言之，不同定制类型的商品，不能同时在同一张订单中出现。

### 2.3.7. 客户编号

按照订单的客户编号进行查询。订单的客户编号是对应于ECC的Sold-to编号，CRM中的BP ID。

客户编号确定了订单的可能来源。

在复合检索条件中，订单的客户编号是用来限定用户可以查询订单范围的重要依据。也是登录Portal到BTCP的用户的权限范围。

在此栏目中，所出现的客户编号就是用户当前的权限范围。超出权限范围的客户编号是不予显示的。也就是说用户也无法查询超出自己权限范围之外的订单。

### 2.3.8. 订单类型

订单类型包含ZOR/ZMOR/FOD

![](imgs/ZorMgmt0013.png)

### 2.3.9. 以上复合

通过以上一个或者多个条件进行复合检索限定的方式。

![](imgs/ZorMgmt0013.png)

# 3 订单明细

订单明细列表区域，位于订单检索条件区域的下方，用来展示检索到的订单的信息。

无论是唯一检索条件还是复合检索条件，最后使用的订单明细列表都是一样的。

![](imgs/ZorMgmt007.png)

如上图，在最左边的BTCPSO一列，其中的编号是可以点击的。

点击编号之后，会弹出此订单的详细信息，供用户做参考。

![](imgs/ZorMgmt008.png)

详情页面仅供展示使用，不能修改其中的任何信息。如果要修改信息，请使用 *修改订单* 功能。

# 4 功能操作区

在订单明细列表区域的右上角，系统提供了若干功能，可供用户对订单进行操作：

![](imgs/ZorMgmt009.png)

主要功能包括
1. 修改订单
2. 修改财务信息
3. 状态历史
4. 修改历史

无论哪个操作，都首先需要在明细列表中先选中一行，然后才能点击相应的按钮进行操作。以下逐一介绍各个操作的功能。

## 4.1 订单修改

修改订单的：
- 发票抬头
- 发票类型
- 送货地址
- 支付时间

首先选中明细列表中的一个订单，然后点击修改订单按钮，展示出如下界面：

![](imgs/ZorMgmt010.png)

### 4.1.1 修改发票抬头

修改抬头即修改订单中的售达方名称，修改是有条件的修改。

当订单状态是在“已打印装箱单”（主状态：12000 子状态：12100）的状态之后，是不允许修改的！只有在此之前的订单才能进行修改。

旧抬头是不能被修改的，在新抬头里面录入需要的title，点击更新按钮就可以修改了。

### 4.1.2 修改发票类型

修改订单的发票类型，新的类型可以从P，D，Z三者之中选一个。但是如果重复选择了跟旧发票类型一样的，就没有意义不是。

修改发票类型要注意订单的状态限制。只有订单的主状态是“正常”（11000）的时候才可以修改。否则不能修改。

其业务意义是，在订单被处理之前，才能修改。

### 4.1.3 修改送货地址

送货地址的修改中，送达方编号，原送达方城市和地址区县都不能修改。

新的送达方内容，部分是手工填写，部分是通过下拉列表带出来的。

更新地址的状态限制于发票类型的是一样的。就是说，在订单打印装箱单之前，才能进行地址修改。

### 4.1.4 修改支付时间

支付时间是手工修改，但是也是有条件限制的。必须是冻结的时候才能够修改，此外，状态还得是在订单被“已处理”（12000）之前

## 4.2 订单修改

![](imgs/ZorMgmt011.png)

修改支付方式将订单原有的支付方式，修改为新的方式。

修改是有状态限制的，只有订单在已经被核销和清账的情况下，是不能修改的。反之，才行。

## 4.3 状态历史

状态历史，展示的是订单的状态信息变化历史，以及冻结的情况。如图：

![](imgs/ZorMgmt012.png)

状态历史中，订单状态是对应系统中的主状态，物流状态对应系统中的子状态，冻结状态对应系统中的冻结状态。

这里就是个简单的列表，将订单的状态变更历史，注意的展示出来。

## 4.4 修改历史

订单的修改历史，就是记录了订单由谁，在什么时候，做了哪些修改。主要是针对修改订单，和修改财务信息两个功能中的内容做的记录。

这里只做展示使用。并不能编辑任何东西。


# JIRA

[SHOP-16324](/JIRA/SHOP-16324-luyi1.md)
[SHOP-16463](/JIRA/SHOP-16463-luyi1.md)